<!DOCTYPE html> <html> <head> <title>That was easy!</title> <meta name="viewport" content="width=device-width, initial-scale=1"> <style>html, body, div, span, h1, form, label, section, p{ margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline;}html{ color:#333;font-size:20px;line-height:20px;font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;}body{ font-size:14px;font-style:normal;font-variant:normal;font-weight:400;line-height:20px;display:flex;height:100vh;width:100vw;background-color:#efefef;}.container{ width:100%;max-width:20rem;margin:auto;flex:1 1 100%;background-color:#fff;padding:1rem;}@media screen and (min-width:26rem){ .container{ box-shadow:0 0 4px rgba(0, 0, 0, 0.2);border-radius:3px;}}header{ font-size:1.2rem;line-height:1.5rem;font-style:normal;font-variant:normal;font-weight:700;padding-top:6.5px;text-align:center;margin:0 auto 13.5px;width:100%;max-width:20rem;}form{ width:100%;max-width:15rem;margin:0 auto;padding-bottom:1rem;}label{ display:block;padding-top:5px;margin-bottom:5px;}a, a:active, a:visited{ color:#29506D;text-decoration:underline;transition:color linear 0.2s;}a:hover{ color:#000;text-decoration:underline;cursor:pointer;}p{ padding-top:5px;margin-bottom:15px;}.wrapper{ display:block;width:100%;height:40px;margin-bottom:1rem;}input, button, select{ width:100%;height:100%;padding:5px 0.5rem;max-width:20rem;box-sizing:border-box;border:1px solid #ccc;}button{ margin-top:1rem;background-color:#29506D;color:#fff;border:0 none;text-transform:uppercase;padding:13px 1rem;font-weight:700;border-radius:5px;transition:background-color 0.4s linear, color 0.4s linear;}.hidden{ display:none;}.notification{ background-color:#CDE4F5;border:1px solid #84B0D2;color:#29506D;padding:5px 1rem;margin:0 auto 15px;max-width:13rem;}.error{ background-color:#FFD4D3;border:1px solid #FFAFAD;color:#D46D6A;}.inline-error{ color:#D46D6A;}button:disabled{ background-color:#aaa;}button:hover{ transition:background-color linear 0.2s;background-color:#496D89;cursor:pointer;}button:disabled:hover{ background-color:#aaa;cursor:default;}button.success, button.success:hover{ background-color:#0ca228;color:#fff;}</style> </head> <body> <div class="container"> <header> <h1>Configure your button</h1> </header> <div class="notification hidden" id="notification"> <p>Your settings have been saved! You can now re-connect to your regular WIFI network.</p> <p>You can access this configuration panel at <a id="device-name-link" href=""></a></p> </div> <div class="notification error hidden" id="error"></div> <section> <form action="post" method="/save" id="form"> <div id="ssid-wrapper" class="hidden"> <label for="ssid">SSID</label> <span class="wrapper"><select id="ssid" disabled><option>Scanning...</option></select></span> </div> <div id="passkey-wrapper" class="hidden"> <label for="passkey"> Passkey <span class="inline-error hidden" id="passkey-error"></span> </label> <span class="wrapper"><input type="text" id="passkey" name="passkey" disabled></span> </div> <div id="device-name-wrapper"> <label for="deviceName"> Device name <span class="inline-error hidden" id="deviceName-error"></span> </label> <span class="wrapper"><input type="text" id="deviceName" name="deviceName" disabled></span> </div> <div id="webhook-wrapper"> <label for="webhook"> Webhook URL <span class="inline-error hidden" id="webhook-error"></span> </label> <span class="wrapper"><input type="text" id="webhook" name="webhook" placeholder="http://someserver.com/webhook.json" disabled></span> </div> <span class="wrapper"><button id="button" disabled>Save</button></span> </form> </section> </div> <script>!function(){function e(){return Object.assign.apply(this,arguments)}function n(e,n,i,a,t){var o=new XMLHttpRequest;o.open(n,e),o.setRequestHeader("Content-type","application/json"),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?a(o.responseText):422==o.status&&t(o.responseText))},i?o.send(i):o.send()}function i(n,i){switch(i.type){case W:return 0==i.aps.length?null:e({},i.aps[0]);case z:return e({},i.ap)}return n}function a(e,n){return n.type!=V&&e}function t(n,i){if(i.type==F){var a=i.value.length>0&&i.value.length<=32;return e({},n,{value:i.value,valid:a,changed:!0})}return n}function o(n,i){if(i.type==K){var a=i.value,t=a.length>0&&a.length<=64;return e({},n,{value:i.value,valid:t,changed:!0})}if(i.type==ee){var a=i.config.deviceName,t=a.length>0&&a.length<=64;return e({},n,{value:a,valid:t,changed:""!=a})}return n}function u(n,i){if(i.type==Q){var a=i.value,t=a.length>0&&a.length<=256;return e({},n,{value:i.value,valid:t,changed:!0})}if(i.type==ee){var a=i.config.webhook,t=a.length>0&&a.length<=256;return e({},n,{value:i.config.webhook,valid:t,changed:""!=a})}return n}function c(e,n){return n.type==$?n.message:e}function s(e,n){return n.type==W?n.aps:e}function r(e,n){switch(n.type){case ee:case Y:case V:case W:case Z:case $:return n.type;default:return e}}function l(n){var l=e({},ie);ie=e({},l);var v=e({},ie.ui);v.passkey=t(v.passkey,n),v.deviceName=o(v.deviceName,n),v.webhook=u(v.webhook,n),ie.error=c(ie.error,n),ie.ap=i(ie.ap,n),ie.apConfigured=a(ie.apConfigured,n),ie.aps=s(ie.aps,n),ie.connection=r(ie.connection,n),ie.ui=v,J(ie,l)}function v(e){return document.getElementById(e)}function p(e,n){if(e.className.indexOf(n)===-1){var i=e.className.split(" ");i.push(n),e.className=i.join(" ")}}function d(e,n){var i=e.className.split(" "),a=i.indexOf(n);a!==-1&&(i.splice(a,1),e.className=i.join(" "))}function f(e){e.removeAttribute(ae)}function h(e){e.setAttribute(ae,ae)}function g(e){d(e,te)}function y(e){p(e,te)}function k(e,n){e.innerHTML=n}function m(e,n){if(e.connection!==n.connection){var i=v("ssid"),a=v("passkey"),t=v("deviceName"),o=v("webhook");switch(e.connection){case ne:case U:case V:h(i),h(a),h(t),h(o);break;default:f(i),f(a),f(t),f(o)}}}function w(e,n){if(e.apConfigured!==n.apConfigured){var i=v("ssid-wrapper");e.apConfigured?y(i):g(i)}}function N(e,n){if(e.connection!==n.connection||e.aps!==n.aps||e.ap!==n.ap){var i=v("ssid"),a=e.aps,t=e.connection,o=e.ap;if(t===V)k(i,"<option>Scanning...</option>");else if(t===ne||t===U||0==a.length)k(i,"");else{for(var u=[],c=0;c<a.length;c++){var s=a[c];u.push('<option value="'+s.ssid+'"'+(o.ssid==s.ssid?" selected":"")+">"+s.ssid+"</option>")}k(i,u.join(""))}}}function b(e,n,i){if(e.ui[i].value!==n.ui[i].value){var a=v(i);a.value!=e.ui[i].value&&(a.value=e.ui[i].value)}}function C(e,n){b(e,n,"passkey")}function L(e,n){b(e,n,"deviceName")}function S(e,n){b(e,n,"webhook")}function T(e,n){var i=e.ap?e.ap.encryption:null,a=n.ap?n.ap.encryption:null,t=e.ui.passkey.value===n.ui.passkey.value;if(t=t&&i===a,!t){var o=v("passkey-wrapper");7==i?y(o):g(o)}}function E(e,n){var i=e.ui.passkey.changed===n.ui.passkey.changed;if(i=i&&e.ui.passkey.valid===n.ui.passkey.valid,i=i&&e.ui.passkey.value===n.ui.passkey.value,!i){var a=e.ui.passkey.value,t=v("passkey-error");e.ui.passkey.changed&&!e.ui.passkey.valid?(0==a.length?k(t,"is required"):a.length>=32&&k(t,"is too long"),g(t)):y(t)}}function j(e,n){var i=e.ui.deviceName.changed===n.ui.deviceName.changed;if(i=i&&e.ui.deviceName.valid===n.ui.deviceName.valid,i=i&&e.ui.deviceName.value===n.ui.deviceName.value,!i){var a=e.ui.deviceName.value,t=v("deviceName-error");e.ui.deviceName.changed&&!e.ui.deviceName.valid?(0==a.length?k(t,"is required"):a.length>=64&&k(t,"is too long"),g(t)):y(t)}}function O(e,n){var i=e.ui.webhook.changed===n.ui.webhook.changed;if(i=i&&e.ui.webhook.valid===n.ui.webhook.valid,i=i&&e.ui.webhook.value===n.ui.webhook.value,!i){var a=e.ui.webhook.value,t=v("webhook-error");e.ui.webhook.changed&&!e.ui.webhook.valid?(0==a.length?k(t,"is required"):a.length>=256&&k(t,"is too long"),g(t)):y(t)}}function q(e,n){var i=e.ap?e.ap.encryption:null,a=n.ap?n.ap.encryption:null,t=e.ui.passkey.valid===n.ui.passkey.valid;if(t=t&&e.ui.deviceName.valid===n.ui.deviceName.valid,t=t&&e.ui.webhook.valid===n.ui.webhook.valid,t=t&&e.connection===n.connection,t=t&&i===a,!t){var o=v("button"),u=e.ui.deviceName.valid&&e.ui.webhook.valid;e.apConfigured||(u=u&&e.connection===W&&(7===i||e.ui.passkey.valid)),e.connection===Y&&(u=!1),u?f(o):h(o)}}function D(e,n){if(e.connection!==n.connection){var i=v("button");e.connection===Y?(d(i,"success"),k(i,"Saving...")):e.apConfigured&&e.connection===Z?(p(i,"success"),k(i,"Saved!")):(d(i,"success"),k(i,"Save"))}}function H(e,n){if(e.connection!==n.connection){var i=v("form");e.apConfigured||e.connection!==Z?g(i):y(i)}}function x(e,n){if(e.connection!==n.connection){var i=v("notification");if(e.apConfigured||e.connection!==Z)y(i);else{var a=v("device-name-link");a.innerHTML=a.href="http://"+e.ui.deviceName.value+".local",g(i)}}}function M(e,n){if(e.connection!==n.connection){var i=v("error");e.connection===$?(i.innerHTML=e.error,g(i)):y(i)}}function J(e,n){m(e,n),w(e,n),N(e,n),C(e,n),L(e,n),S(e,n),T(e,n),E(e,n),j(e,n),O(e,n),q(e,n),D(e,n),H(e,n),x(e,n),M(e,n)}function A(){l({type:V}),n("/browse.json","GET",null,function(e){l({type:W,aps:JSON.parse(e)})})}function G(){l({type:_}),n("/config.json","GET",null,function(e){var n=JSON.parse(e);l({type:ee,config:n}),n.apConfigured||A()})}function R(e){e.preventDefault();for(var n=null,i=ie.aps,a=0;a<i.length;a++)i[a].ssid==e.target.value&&(n=i[a]);l({type:z,ap:n})}function B(e){e.preventDefault(),l({type:F,value:e.target.value})}function I(e){e.preventDefault(),l({type:K,value:e.target.value})}function P(e){e.preventDefault(),l({type:Q,value:e.target.value})}function X(e){e.preventDefault();var i=ie.ui.deviceName.value,a=ie.ui.webhook.value,t={deviceName:i,webhook:a};ie.apConfigured||(t.ssid=ie.ap.ssid,7!=ie.ap.encryption&&(t.passkey=ie.ui.passkey.value)),l({type:Y}),n("/save","POST",JSON.stringify(t),function(){l({type:Z}),ie.apConfigured&&setTimeout(function(){l({type:ee,config:t}),window.location.hostname!=ie.ui.deviceName.value+".local"&&(window.location="http://"+ie.ui.deviceName.value+".local")},1e3)},function(e){l({type:$,message:e})})}var z=4,F=5,K=6,Q=7,U=8,V=9,W=10,Y=11,Z=12,$=13,_=14,ee=15,ne=16,ie={ui:{passkey:{changed:!1,valid:!1,error:null,value:""},deviceName:{changed:!1,valid:!1,error:null,value:""},webhook:{changed:!1,valid:!1,error:null,value:""}},aps:[],ap:null,apConfigured:!0,error:"",connection:ne},ae="disabled",te="hidden";v("ssid").addEventListener("change",R,!0),v("passkey").addEventListener("input",B,!0),v("deviceName").addEventListener("input",I,!0),v("webhook").addEventListener("input",P,!0),v("form").addEventListener("submit",X,!0),G()}();</script> </body> </html> 
